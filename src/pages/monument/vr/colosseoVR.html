<!DOCTYPE html>
<html lang="it">
<head>
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <style>
    .exit-button {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      background-color: #FF3366;
      color: white;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      z-index: 9999;
      border: 2px solid white;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }
    .exit-button:hover {
      background-color: #FF0033;
    }
  </style>
</head>
<body>
  <div class="exit-button" onclick="exitVR()">X</div>
  
  <a-scene webxr>
    <!-- Skybox a 360° -->
    <a-sky src="/src/resources/images/monuments/vr/colosseo/img1.jpg" rotation="0 -90 0"></a-sky>

    <!-- Testo ottimizzato per VR -->
    <a-text
            value="Colosseo"
            position="-1 1 -3"
            color="#FFF"
            align="center"
            scale="2 2 2">
    </a-text>

    <!-- Telecamera + controlli VR -->
    <a-entity id="camera" camera look-controls wasd-controls position="0 0 0"></a-entity>
    <a-entity laser-controls="hand: right"></a-entity>
    <a-entity laser-controls="hand: left"></a-entity>
    
    <!-- Pulsante di uscita in VR migliorato -->
    <a-entity class="exit-button-vr" 
              position="1 1.5 -2"
              geometry="primitive: box; width: 0.4; height: 0.4; depth: 0.01"
              material="color: #FF3366; shader: flat"
              text="value: Esci; align: center; color: white; width: 0.6"
              look-at="#camera"
              cursor-listener
              animation__hover="property: scale; to: 1.1 1.1 1.1; startEvents: mouseenter; dur: 200"
              animation__unhover="property: scale; to: 1 1 1; startEvents: mouseleave; dur: 200"
              animation__click="property: scale; to: 0.9 0.9 0.9; startEvents: click; dur: 100; dir: alternate"
              sound="src: #click-sound; on: click">
      <a-entity position="0 0 0.021"
                text="value: X; align: center; color: white; width: 0.2"></a-entity>
    </a-entity>
    
    <audio id="click-sound" src="https://cdn.aframe.io/360-image-gallery-boilerplate/audio/click.ogg" preload="auto"></audio>
  </a-scene>

  <script>
    function showInfo(place) {
      alert(`Hai cliccato su ${place}!`);
    }
    
    function exitVR() {
      const scene = document.querySelector('a-scene');
      if (scene.is('vr-mode')) {
        // Forza l'uscita dalla VR
        scene.exitVR().then(() => {
          console.log("Uscito dalla modalità VR");
          // Aggiungi qui eventuali azioni post-uscita
        }).catch(err => {
          console.error("Errore nell'uscita dalla VR:", err);
        });
      }
      // Puoi aggiungere un reindirizzamento o altre azioni qui
      // window.location.href = 'index.html';
    }
    
    // Migliora l'interazione con il visore
    document.addEventListener('DOMContentLoaded', function() {
      const vrButton = document.querySelector('.exit-button-vr');
      
      // Aggiungi event listener per controller VR
      vrButton.addEventListener('click', exitVR);
      vrButton.addEventListener('mouseenter', function() {
        this.setAttribute('material', 'color', '#FF0033');
      });
      vrButton.addEventListener('mouseleave', function() {
        this.setAttribute('material', 'color', '#FF3366');
      });
    });
    
    // Gestione della visibilità del pulsante 2D
    document.querySelector('a-scene').addEventListener('enter-vr', function() {
      document.querySelector('.exit-button').style.display = 'none';
    });
    
    document.querySelector('a-scene').addEventListener('exit-vr', function() {
      document.querySelector('.exit-button').style.display = 'flex';
    });
  </script>
</body>
</html>
